<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusCloud Pro 2026 | BS Information Technology</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e1e2e; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #6366f1, #8b5cf6); border-radius: 10px; }
        
        @keyframes gradient { 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        @keyframes pulse-glow { 0%,100%{box-shadow:0 0 20px rgba(99,102,241,0.5)} 50%{box-shadow:0 0 40px rgba(139,92,246,0.8)} }
        @keyframes slideIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
        @keyframes slideUp { from{opacity:0;transform:translateY(40px)} to{opacity:1;transform:translateY(0)} }
        @keyframes spin { to{transform:rotate(360deg)} }
        @keyframes shimmer { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
        @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }
        
        .gradient-bg { background:linear-gradient(-45deg,#0f0f1a,#1a1a2e,#16213e,#0f0f1a); background-size:400% 400%; animation:gradient 15s ease infinite; }
        .glass { background:rgba(255,255,255,0.05); backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.1); }
        .glass-dark { background:rgba(0,0,0,0.3); backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.05); }
        .glass-hover:hover { background:rgba(255,255,255,0.1); transform:translateY(-2px); }
        .neon-border { border:2px solid transparent; background:linear-gradient(#1a1a2e,#1a1a2e) padding-box, linear-gradient(135deg,#6366f1,#8b5cf6,#a855f7) border-box; }
        .neon-glow { box-shadow: 0 0 20px rgba(99,102,241,0.3), 0 0 40px rgba(139,92,246,0.2); }
        .float { animation:float 3s ease-in-out infinite; }
        .pulse-glow { animation:pulse-glow 2s ease-in-out infinite; }
        .slide-in { animation:slideIn 0.5s ease forwards; }
        .slide-up { animation:slideUp 0.6s ease forwards; }
        .loader { width:40px; height:40px; border:4px solid rgba(99,102,241,0.3); border-top-color:#6366f1; border-radius:50%; animation:spin 1s linear infinite; }
        .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        
        .particle { position: absolute; background: rgba(255, 255, 255, 0.03); border-radius: 50%; pointer-events: none; width: 4px; height: 4px; animation: float 20s infinite linear; }

        .file-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .file-card:hover { transform:translateY(-8px) scale(1.02); box-shadow:0 25px 50px rgba(99,102,241,0.4); }
        .nav-item { transition: all 0.3s ease; }
        .nav-item:hover { background:linear-gradient(135deg,rgba(99,102,241,0.2),rgba(139,92,246,0.2)); transform: translateX(5px); }
        .nav-item.active { background:linear-gradient(135deg,#6366f1,#8b5cf6); box-shadow: 0 10px 30px rgba(99,102,241,0.4); }
        
        .stat-card { position:relative; overflow:hidden; transition: all 0.3s ease; }
        .stat-card::before { content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:linear-gradient(45deg,transparent,rgba(255,255,255,0.1),transparent); transform:rotate(45deg); transition:0.6s; }
        .stat-card:hover::before { left:100%; }
        .stat-card:hover { transform: translateY(-5px); }
        
        .sql-editor { background:#0d1117; font-family:'Fira Code', 'Consolas', monospace; }
        .table-row:hover { background:rgba(99,102,241,0.15); }
        
        .progress-ring { transform:rotate(-90deg); }
        .progress-ring circle { transition:stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(99,102,241,0.4); }
        
        .online-indicator { animation: bounce 2s infinite; }
        .connection-status.online { color: #10b981; }
        .connection-status.offline { color: #f59e0b; }
        
        /* Mobile Responsive */
        @media (max-width: 1024px) {
            #sidebar { transform: translateX(-100%); }
            #sidebar.open { transform: translateX(0); }
            main { margin-left: 0 !important; }
            .mobile-menu-btn { display: flex !important; }
        }
        
        .mobile-menu-btn { display: none; }
        
        /* Drag and drop highlight */
        .drop-active { border-color: #6366f1 !important; background: rgba(99, 102, 241, 0.2) !important; }
        
        /* Context Menu */
        .context-menu { 
            position: fixed; 
            z-index: 1000; 
            min-width: 180px;
            animation: slideIn 0.2s ease;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 z-[100] gradient-bg flex items-center justify-center">
        <div class="text-center">
            <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center pulse-glow mx-auto mb-6">
                <i class="fas fa-cloud text-4xl"></i>
            </div>
            <div class="loader mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">NexusCloud Pro</h2>
            <p class="text-gray-400 text-sm mt-2">Initializing your cloud...</p>
        </div>
    </div>

    <!-- Particles Background -->
    <div id="particles" class="fixed inset-0 pointer-events-none overflow-hidden z-0"></div>
    
    <!-- Connection Status Banner -->
    <div id="connectionBanner" class="fixed top-0 left-0 right-0 z-[60] hidden">
        <div class="bg-yellow-500/90 backdrop-blur-sm text-black text-center py-2 text-sm font-medium">
            <i class="fas fa-wifi mr-2"></i>
            <span id="connectionMessage">Working offline - Changes will sync when online</span>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="flex min-h-screen relative z-10">
        <!-- Mobile Menu Button -->
        <button onclick="toggleSidebar()" class="mobile-menu-btn fixed top-4 left-4 z-[60] p-3 glass rounded-xl lg:hidden">
            <i class="fas fa-bars text-xl"></i>
        </button>
        
        <!-- Sidebar Overlay -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar -->
        <aside id="sidebar" class="w-72 glass-dark p-6 flex flex-col fixed h-full z-50 transition-transform duration-300">
            <div class="flex items-center gap-3 mb-8">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center pulse-glow">
                    <i class="fas fa-cloud text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">NexusCloud</h1>
                    <p class="text-xs text-gray-400">Pro Edition 2026</p>
                </div>
                <div id="cloudStatus" class="ml-auto">
                    <span class="connection-status online online-indicator">
                        <i class="fas fa-circle text-xs"></i>
                    </span>
                </div>
            </div>
            
            <!-- Cloud Provider Selector -->
            <div class="glass rounded-xl p-3 mb-4">
                <label class="text-xs text-gray-400 block mb-2">Storage Backend</label>
                <select id="storageProvider" onchange="switchProvider(this.value)" class="w-full bg-transparent text-sm p-2 rounded-lg border border-white/10 focus:outline-none focus:border-indigo-500">
                    <option value="local" selected>üì± Local (IndexedDB)</option>
                    <option value="supabase">‚òÅÔ∏è Supabase Cloud</option>
                    <option value="github">üêô GitHub Storage</option>
                </select>
            </div>
            
            <nav class="flex-1 space-y-2">
                <button onclick="showSection('dashboard')" class="nav-item active w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300" data-section="dashboard">
                    <i class="fas fa-th-large w-5"></i><span>Dashboard</span>
                </button>
                <button onclick="showSection('files')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300" data-section="files">
                    <i class="fas fa-folder w-5"></i><span>My Files</span>
                    <span id="filesBadge" class="ml-auto text-xs bg-indigo-500/30 px-2 py-0.5 rounded-full hidden">0</span>
                </button>
                <button onclick="showSection('upload')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300" data-section="upload">
                    <i class="fas fa-cloud-upload-alt w-5"></i><span>Upload</span>
                </button>
                <button onclick="showSection('database')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300" data-section="database">
                    <i class="fas fa-database w-5"></i><span>SQL Database</span>
                </button>
                <button onclick="showSection('analytics')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300" data-section="analytics">
                    <i class="fas fa-chart-line w-5"></i><span>Analytics</span>
                </button>
                <button onclick="showSection('shared')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300" data-section="shared">
                    <i class="fas fa-share-nodes w-5"></i><span>Shared</span>
                </button>
                <button onclick="showSection('settings')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300" data-section="settings">
                    <i class="fas fa-cog w-5"></i><span>Settings</span>
                </button>
            </nav>
            
            <!-- Storage Widget -->
            <div class="glass rounded-2xl p-4 mt-4 neon-glow">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm text-gray-400">Storage Used</span>
                    <span id="storagePercent" class="text-sm font-bold text-indigo-400">0%</span>
                </div>
                <div class="w-full h-3 bg-gray-700 rounded-full overflow-hidden">
                    <div id="storageBar" class="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-full transition-all duration-700" style="width:0%"></div>
                </div>
                <div class="flex justify-between mt-2">
                    <p id="storageText" class="text-xs text-gray-500">0 B of 1 GB</p>
                    <p id="storageProvider" class="text-xs text-indigo-400">Local Storage</p>
                </div>
            </div>
            
            <!-- User Profile -->
            <div class="flex items-center gap-3 mt-6 p-3 glass rounded-xl glass-hover cursor-pointer" onclick="showSection('settings')">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                    <i class="fas fa-user"></i>
                </div>
                <div class="flex-1">
                    <p id="userName" class="text-sm font-semibold">BSIT Student</p>
                    <p class="text-xs text-gray-400">Class of 2026</p>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 ml-0 lg:ml-72 p-4 lg:p-8 pt-20 lg:pt-8">
            <!-- Header -->
            <header class="flex flex-col lg:flex-row items-start lg:items-center justify-between mb-8 gap-4">
                <div>
                    <h2 id="pageTitle" class="text-2xl lg:text-3xl font-bold">Dashboard</h2>
                    <p class="text-gray-400 text-sm lg:text-base">Welcome to NexusCloud Pro - Your Ultimate Cloud Solution</p>
                </div>
                <div class="flex items-center gap-3 w-full lg:w-auto">
                    <div class="relative flex-1 lg:flex-none">
                        <input type="text" id="globalSearch" placeholder="Search files..." class="w-full lg:w-80 px-5 py-3 pl-12 glass rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <div id="searchResults" class="absolute top-full left-0 right-0 mt-2 glass rounded-xl hidden max-h-80 overflow-auto"></div>
                    </div>
                    <button onclick="showNotifications()" class="relative p-3 glass rounded-xl hover:bg-white/10 transition-all">
                        <i class="fas fa-bell"></i>
                        <span id="notifBadge" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs flex items-center justify-center">0</span>
                    </button>
                    <button onclick="syncData()" id="syncBtn" class="p-3 glass rounded-xl hover:bg-white/10 transition-all" title="Sync Data">
                        <i class="fas fa-sync-alt" id="syncIcon"></i>
                    </button>
                </div>
            </header>
            
            <!-- Dashboard Section -->
            <section id="dashboardSection" class="space-y-8">
                <!-- Stats Grid -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
                    <div class="stat-card glass rounded-2xl p-4 lg:p-6 neon-border slide-up" style="animation-delay: 0.1s">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs lg:text-sm">Total Files</p>
                                <h3 id="totalFiles" class="text-2xl lg:text-3xl font-bold mt-1">0</h3>
                            </div>
                            <div class="w-12 h-12 lg:w-14 lg:h-14 rounded-2xl bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex items-center justify-center">
                                <i class="fas fa-file text-xl lg:text-2xl text-indigo-400"></i>
                            </div>
                        </div>
                        <p class="text-green-400 text-xs lg:text-sm mt-4"><i class="fas fa-arrow-up mr-1"></i>Scalable Storage</p>
                    </div>
                    
                    <div class="stat-card glass rounded-2xl p-4 lg:p-6 neon-border slide-up" style="animation-delay: 0.2s">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs lg:text-sm">Storage Used</p>
                                <h3 id="totalSize" class="text-2xl lg:text-3xl font-bold mt-1">0 B</h3>
                            </div>
                            <div class="w-12 h-12 lg:w-14 lg:h-14 rounded-2xl bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center">
                                <i class="fas fa-hdd text-xl lg:text-2xl text-green-400"></i>
                            </div>
                        </div>
                        <p class="text-blue-400 text-xs lg:text-sm mt-4"><i class="fas fa-infinity mr-1"></i><span id="maxStorageDisplay">1 GB</span> Available</p>
                    </div>
                    
                    <div class="stat-card glass rounded-2xl p-4 lg:p-6 neon-border slide-up" style="animation-delay: 0.3s">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs lg:text-sm">Database Records</p>
                                <h3 id="totalRecords" class="text-2xl lg:text-3xl font-bold mt-1">0</h3>
                            </div>
                            <div class="w-12 h-12 lg:w-14 lg:h-14 rounded-2xl bg-gradient-to-br from-orange-500/20 to-amber-500/20 flex items-center justify-center">
                                <i class="fas fa-database text-xl lg:text-2xl text-orange-400"></i>
                            </div>
                        </div>
                        <p class="text-purple-400 text-xs lg:text-sm mt-4"><i class="fas fa-bolt mr-1"></i>SQL Powered</p>
                    </div>
                    
                    <div class="stat-card glass rounded-2xl p-4 lg:p-6 neon-border slide-up" style="animation-delay: 0.4s">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs lg:text-sm">Sync Status</p>
                                <h3 id="syncStatus" class="text-2xl lg:text-3xl font-bold mt-1">Local</h3>
                            </div>
                            <div class="w-12 h-12 lg:w-14 lg:h-14 rounded-2xl bg-gradient-to-br from-pink-500/20 to-rose-500/20 flex items-center justify-center">
                                <i class="fas fa-cloud text-xl lg:text-2xl text-pink-400"></i>
                            </div>
                        </div>
                        <p id="lastSyncText" class="text-emerald-400 text-xs lg:text-sm mt-4"><i class="fas fa-check mr-1"></i>Ready</p>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="glass rounded-2xl p-6 slide-up" style="animation-delay: 0.5s">
                    <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="showSection('upload')" class="p-4 lg:p-6 glass rounded-xl hover:bg-indigo-500/20 transition-all group">
                            <i class="fas fa-upload text-2xl lg:text-3xl text-indigo-400 group-hover:scale-110 transition-transform"></i>
                            <p class="mt-2 font-medium text-sm lg:text-base">Upload Files</p>
                        </button>
                        <button onclick="showSection('database')" class="p-4 lg:p-6 glass rounded-xl hover:bg-purple-500/20 transition-all group">
                            <i class="fas fa-table text-2xl lg:text-3xl text-purple-400 group-hover:scale-110 transition-transform"></i>
                            <p class="mt-2 font-medium text-sm lg:text-base">Create Table</p>
                        </button>
                        <button onclick="createFolder()" class="p-4 lg:p-6 glass rounded-xl hover:bg-green-500/20 transition-all group">
                            <i class="fas fa-folder-plus text-2xl lg:text-3xl text-green-400 group-hover:scale-110 transition-transform"></i>
                            <p class="mt-2 font-medium text-sm lg:text-base">New Folder</p>
                        </button>
                        <button onclick="exportData()" class="p-4 lg:p-6 glass rounded-xl hover:bg-orange-500/20 transition-all group">
                            <i class="fas fa-download text-2xl lg:text-3xl text-orange-400 group-hover:scale-110 transition-transform"></i>
                            <p class="mt-2 font-medium text-sm lg:text-base">Export Data</p>
                        </button>
                    </div>
                </div>
                
                <!-- Recent Files -->
                <div class="glass rounded-2xl p-6 slide-up" style="animation-delay: 0.6s">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">Recent Files</h3>
                        <button onclick="showSection('files')" class="text-indigo-400 hover:text-indigo-300 text-sm lg:text-base">View All <i class="fas fa-arrow-right ml-1"></i></button>
                    </div>
                    <div id="recentFiles" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="skeleton h-24 rounded-xl"></div>
                        <div class="skeleton h-24 rounded-xl hidden md:block"></div>
                        <div class="skeleton h-24 rounded-xl hidden lg:block"></div>
                    </div>
                </div>
                
                <!-- Cloud Setup Guide -->
                <div id="setupGuide" class="glass rounded-2xl p-6 bg-gradient-to-br from-indigo-900/30 to-purple-900/30 slide-up" style="animation-delay: 0.7s">
                    <div class="flex items-start justify-between">
                        <div>
                            <h3 class="text-xl font-bold mb-2"><i class="fas fa-rocket mr-2"></i>Enable Cloud Sync (FREE)</h3>
                            <p class="text-gray-400 mb-4">Connect to Supabase for free cloud storage with real sync across devices</p>
                        </div>
                        <button onclick="hideSetupGuide()" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="glass rounded-xl p-4 text-center">
                            <div class="w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center mx-auto mb-3">
                                <span class="text-xl font-bold text-indigo-400">1</span>
                            </div>
                            <h4 class="font-semibold mb-1">Sign Up</h4>
                            <p class="text-xs text-gray-400">Create free Supabase account</p>
                            <a href="https://supabase.com" target="_blank" class="text-indigo-400 text-xs hover:underline">supabase.com ‚Üí</a>
                        </div>
                        <div class="glass rounded-xl p-4 text-center">
                            <div class="w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mx-auto mb-3">
                                <span class="text-xl font-bold text-purple-400">2</span>
                            </div>
                            <h4 class="font-semibold mb-1">Get Keys</h4>
                            <p class="text-xs text-gray-400">Copy your API URL & Key</p>
                        </div>
                        <div class="glass rounded-xl p-4 text-center">
                            <div class="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-3">
                                <span class="text-xl font-bold text-green-400">3</span>
                            </div>
                            <h4 class="font-semibold mb-1">Connect</h4>
                            <p class="text-xs text-gray-400">Paste in Settings ‚Üí Cloud</p>
                            <button onclick="showSection('settings')" class="text-green-400 text-xs hover:underline">Go to Settings ‚Üí</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Files Section -->
            <section id="filesSection" class="hidden space-y-6">
                <div class="flex flex-wrap items-center gap-3 mb-6">
                    <button onclick="showSection('upload')" class="px-4 lg:px-6 py-3 btn-primary rounded-xl font-semibold text-sm lg:text-base">
                        <i class="fas fa-plus mr-2"></i>Upload
                    </button>
                    <button onclick="createFolder()" class="px-4 lg:px-6 py-3 glass rounded-xl font-semibold hover:bg-white/10 transition-all text-sm lg:text-base">
                        <i class="fas fa-folder-plus mr-2"></i>Folder
                    </button>
                    <select id="fileFilter" onchange="filterFiles()" class="px-4 py-3 glass rounded-xl bg-transparent focus:outline-none text-sm">
                        <option value="all">All Files</option>
                        <option value="image">Images</option>
                        <option value="document">Documents</option>
                        <option value="video">Videos</option>
                        <option value="audio">Audio</option>
                        <option value="folder">Folders</option>
                    </select>
                    <select id="sortOrder" onchange="sortFiles()" class="px-4 py-3 glass rounded-xl bg-transparent focus:outline-none text-sm">
                        <option value="newest">Newest</option>
                        <option value="oldest">Oldest</option>
                        <option value="name">Name A-Z</option>
                        <option value="size">Size</option>
                    </select>
                    <div class="ml-auto flex gap-2">
                        <button onclick="setView('grid')" id="gridViewBtn" class="p-3 glass rounded-xl bg-white/10">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button onclick="setView('list')" id="listViewBtn" class="p-3 glass rounded-xl hover:bg-white/10">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Breadcrumb -->
                <div id="breadcrumb" class="flex items-center gap-2 text-gray-400 text-sm overflow-x-auto pb-2">
                    <button onclick="navigateToFolder(null)" class="hover:text-white flex-shrink-0"><i class="fas fa-home"></i></button>
                    <span>/</span>
                    <span id="currentPath" class="flex-shrink-0">Root</span>
                </div>
                
                <!-- Selection Bar -->
                <div id="selectionBar" class="glass rounded-xl p-3 hidden flex items-center justify-between">
                    <span id="selectedCount" class="text-sm">0 items selected</span>
                    <div class="flex gap-2">
                        <button onclick="downloadSelected()" class="px-4 py-2 glass rounded-lg text-sm hover:bg-white/10">
                            <i class="fas fa-download mr-2"></i>Download
                        </button>
                        <button onclick="deleteSelected()" class="px-4 py-2 glass rounded-lg text-sm text-red-400 hover:bg-red-500/20">
                            <i class="fas fa-trash mr-2"></i>Delete
                        </button>
                        <button onclick="clearSelection()" class="px-4 py-2 glass rounded-lg text-sm hover:bg-white/10">
                            Cancel
                        </button>
                    </div>
                </div>
                
                <div id="filesGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 lg:gap-6">
                    <p class="text-gray-400 col-span-full text-center py-12">Loading files...</p>
                </div>
            </section>
            
            <!-- Upload Section -->
            <section id="uploadSection" class="hidden space-y-6">
                <div id="dropZone" class="glass rounded-2xl p-8 lg:p-12 border-2 border-dashed border-indigo-500/50 text-center cursor-pointer hover:border-indigo-400 hover:bg-indigo-500/10 transition-all">
                    <i class="fas fa-cloud-upload-alt text-5xl lg:text-6xl text-indigo-400 mb-4 float"></i>
                    <h3 class="text-xl lg:text-2xl font-bold mb-2">Drag & Drop Files Here</h3>
                    <p class="text-gray-400 mb-4">or click to browse ‚Ä¢ Max 50MB per file</p>
                    <input type="file" id="fileInput" multiple class="hidden">
                    <button onclick="document.getElementById('fileInput').click()" class="px-6 lg:px-8 py-3 btn-primary rounded-xl font-semibold">
                        <i class="fas fa-folder-open mr-2"></i>Select Files
                    </button>
                </div>
                
                <!-- Upload Progress -->
                <div id="uploadQueue" class="glass rounded-2xl p-6 hidden">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">Upload Queue</h3>
                        <button onclick="cancelAllUploads()" class="text-red-400 hover:text-red-300 text-sm">
                            Cancel All
                        </button>
                    </div>
                    <div id="uploadList" class="space-y-3 max-h-60 overflow-auto"></div>
                </div>
                
                <!-- Upload Tips -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="glass rounded-xl p-4 text-center">
                        <i class="fas fa-file-image text-2xl text-indigo-400 mb-2"></i>
                        <h4 class="font-semibold text-sm">Images</h4>
                        <p class="text-xs text-gray-400">PNG, JPG, GIF, WebP, SVG</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <i class="fas fa-file-alt text-2xl text-purple-400 mb-2"></i>
                        <h4 class="font-semibold text-sm">Documents</h4>
                        <p class="text-xs text-gray-400">PDF, DOC, TXT, XLSX, PPT</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <i class="fas fa-file-video text-2xl text-green-400 mb-2"></i>
                        <h4 class="font-semibold text-sm">Videos</h4>
                        <p class="text-xs text-gray-400">MP4, WebM, MOV, AVI</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <i class="fas fa-file-audio text-2xl text-orange-400 mb-2"></i>
                        <h4 class="font-semibold text-sm">Audio</h4>
                        <p class="text-xs text-gray-400">MP3, WAV, OGG, FLAC</p>
                    </div>
                </div>
            </section>
            
            <!-- Database Section -->
            <section id="databaseSection" class="hidden space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- SQL Editor -->
                    <div class="glass rounded-2xl overflow-hidden">
                        <div class="flex items-center justify-between p-4 border-b border-white/10">
                            <h3 class="font-bold"><i class="fas fa-terminal mr-2 text-green-400"></i>SQL Query Editor</h3>
                            <div class="flex gap-2">
                                <button onclick="formatSQL()" class="px-3 py-1 text-xs glass rounded-lg hover:bg-white/10" title="Format SQL">
                                    <i class="fas fa-align-left"></i>
                                </button>
                                <button onclick="clearSQL()" class="px-3 py-1 text-xs glass rounded-lg hover:bg-white/10" title="Clear">
                                    <i class="fas fa-eraser"></i>
                                </button>
                                <button onclick="showSQLHistory()" class="px-3 py-1 text-xs glass rounded-lg hover:bg-white/10" title="History">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </div>
                        <div class="relative">
                            <div id="lineNumbers" class="absolute left-0 top-0 bottom-0 w-10 bg-black/30 text-gray-500 text-xs p-4 text-right select-none overflow-hidden">1</div>
                            <textarea id="sqlEditor" class="sql-editor w-full h-64 p-4 pl-14 text-green-400 focus:outline-none resize-none" placeholder="-- Enter SQL query
-- Examples:
-- CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT, email TEXT)
-- INSERT INTO users (name, email) VALUES ('John', 'john@email.com')
-- SELECT * FROM users WHERE name LIKE '%John%'
-- UPDATE users SET name = 'Jane' WHERE id = 1
-- DELETE FROM users WHERE id = 1" spellcheck="false"></textarea>
                        </div>
                        <div class="p-4 border-t border-white/10 flex gap-2">
                            <button onclick="executeSQL()" class="flex-1 px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg font-semibold hover:opacity-90 transition-all">
                                <i class="fas fa-play mr-2"></i>Execute
                            </button>
                            <button onclick="explainSQL()" class="px-4 py-2 glass rounded-lg hover:bg-white/10" title="Explain Query">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Query Results -->
                    <div class="glass rounded-2xl overflow-hidden">
                        <div class="flex items-center justify-between p-4 border-b border-white/10">
                            <h3 class="font-bold"><i class="fas fa-table mr-2 text-indigo-400"></i>Query Results</h3>
                            <div class="flex gap-2">
                                <button onclick="exportResults()" class="px-3 py-1 text-xs glass rounded-lg hover:bg-white/10" title="Export CSV">
                                    <i class="fas fa-download"></i>
                                </button>
                                <span id="queryTime" class="text-xs text-gray-400"></span>
                            </div>
                        </div>
                        <div id="queryResults" class="p-4 min-h-64 max-h-96 overflow-auto">
                            <p class="text-gray-400 text-center py-8">
                                <i class="fas fa-database text-4xl mb-4 block opacity-50"></i>
                                Execute a query to see results
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Database Tables -->
                <div class="glass rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold"><i class="fas fa-layer-group mr-2"></i>Database Tables</h3>
                        <button onclick="refreshTables()" class="text-sm text-indigo-400 hover:text-indigo-300">
                            <i class="fas fa-sync-alt mr-1"></i>Refresh
                        </button>
                    </div>
                    <div id="tablesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <p class="text-gray-400 col-span-full text-center py-8">No tables created yet. Use CREATE TABLE to get started!</p>
                    </div>
                </div>
                
                <!-- Quick SQL Templates -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4"><i class="fas fa-magic mr-2"></i>Quick Templates</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="loadTemplate('users')" class="p-4 glass rounded-xl hover:bg-indigo-500/20 transition-all text-left group">
                            <i class="fas fa-users text-xl text-indigo-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium text-sm">Users Table</p>
                            <p class="text-xs text-gray-400">id, name, email, created</p>
                        </button>
                        <button onclick="loadTemplate('products')" class="p-4 glass rounded-xl hover:bg-purple-500/20 transition-all text-left group">
                            <i class="fas fa-box text-xl text-purple-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium text-sm">Products Table</p>
                            <p class="text-xs text-gray-400">id, name, price, stock</p>
                        </button>
                        <button onclick="loadTemplate('orders')" class="p-4 glass rounded-xl hover:bg-green-500/20 transition-all text-left group">
                            <i class="fas fa-shopping-cart text-xl text-green-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium text-sm">Orders Table</p>
                            <p class="text-xs text-gray-400">id, user_id, total, status</p>
                        </button>
                        <button onclick="loadTemplate('logs')" class="p-4 glass rounded-xl hover:bg-orange-500/20 transition-all text-left group">
                            <i class="fas fa-history text-xl text-orange-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium text-sm">Logs Table</p>
                            <p class="text-xs text-gray-400">id, action, timestamp</p>
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Analytics Section -->
            <section id="analyticsSection" class="hidden space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Storage Distribution -->
                    <div class="glass rounded-2xl p-6">
                        <h3 class="text-xl font-bold mb-4">Storage Distribution</h3>
                        <div class="flex items-center justify-center relative">
                            <svg class="progress-ring w-48 h-48" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="40" stroke="#1e1e2e" stroke-width="8" fill="none"/>
                                <circle id="storageRing" cx="50" cy="50" r="40" stroke="url(#gradient)" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="251.2" stroke-dashoffset="251.2"/>
                                <defs>
                                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" stop-color="#6366f1"/>
                                        <stop offset="100%" stop-color="#8b5cf6"/>
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="absolute text-center">
                                <p id="ringPercent" class="text-3xl font-bold">0%</p>
                                <p class="text-gray-400 text-sm">Used</p>
                            </div>
                        </div>
                        <div id="storageBreakdown" class="mt-6 space-y-3"></div>
                    </div>
                    
                    <!-- File Types Chart -->
                    <div class="glass rounded-2xl p-6">
                        <h3 class="text-xl font-bold mb-4">Files by Type</h3>
                        <div id="fileTypesChart" class="space-y-4"></div>
                    </div>
                </div>
                
                <!-- Activity Timeline -->
                <div class="glass rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">Recent Activity</h3>
                        <button onclick="clearActivity()" class="text-sm text-gray-400 hover:text-white">Clear All</button>
                    </div>
                    <div id="activityLog" class="space-y-3 max-h-80 overflow-auto">
                        <p class="text-gray-400 text-center py-8">No recent activity</p>
                    </div>
                </div>
            </section>
            
            <!-- Shared Section -->
            <section id="sharedSection" class="hidden space-y-6">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4">Shared Files</h3>
                    <p class="text-gray-400 mb-4">Files you've shared with others</p>
                    <div id="sharedFilesList" class="space-y-4">
                        <p class="text-gray-400 text-center py-8">
                            <i class="fas fa-share-alt text-4xl mb-4 block opacity-50"></i>
                            No shared files yet. Share a file to see it here.
                        </p>
                    </div>
                </div>
                
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4">Shared With Me</h3>
                    <div id="sharedWithMe" class="space-y-4">
                        <p class="text-gray-400 text-center py-8">
                            <i class="fas fa-inbox text-4xl mb-4 block opacity-50"></i>
                            No files shared with you yet.
                        </p>
                    </div>
                </div>
            </section>
            
            <!-- Settings Section -->
            <section id="settingsSection" class="hidden space-y-6">
                <!-- Cloud Configuration -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4"><i class="fas fa-cloud mr-2 text-indigo-400"></i>Cloud Storage Configuration</h3>
                    <div class="space-y-4">
                        <!-- Supabase Config -->
                        <div class="glass rounded-xl p-4">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <img src="https://supabase.com/favicon/favicon-32x32.png" class="w-6 h-6" alt="Supabase">
                                    <div>
                                        <p class="font-medium">Supabase (Recommended)</p>
                                        <p class="text-xs text-gray-400">1GB storage ‚Ä¢ 500MB database ‚Ä¢ FREE forever</p>
                                    </div>
                                </div>
                                <span id="supabaseStatus" class="text-xs px-2 py-1 rounded-full bg-gray-500/20 text-gray-400">Not connected</span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 block mb-1">Project URL</label>
                                    <input type="text" id="supabaseUrl" placeholder="https://xxxxx.supabase.co" class="w-full px-4 py-2 glass rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 block mb-1">Anon/Public Key</label>
                                    <input type="password" id="supabaseKey" placeholder="eyJhbG..." class="w-full px-4 py-2 glass rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                                </div>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button onclick="connectSupabase()" class="px-4 py-2 btn-primary rounded-lg text-sm">
                                    <i class="fas fa-plug mr-2"></i>Connect
                                </button>
                                <button onclick="testSupabase()" class="px-4 py-2 glass rounded-lg text-sm hover:bg-white/10">
                                    <i class="fas fa-vial mr-2"></i>Test Connection
                                </button>
                                <a href="https://supabase.com/dashboard" target="_blank" class="px-4 py-2 glass rounded-lg text-sm hover:bg-white/10">
                                    <i class="fas fa-external-link-alt mr-2"></i>Open Dashboard
                                </a>
                            </div>
                        </div>
                        
                        <!-- GitHub Config -->
                        <div class="glass rounded-xl p-4">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <i class="fab fa-github text-2xl"></i>
                                    <div>
                                        <p class="font-medium">GitHub Storage</p>
                                        <p class="text-xs text-gray-400">1GB per repo ‚Ä¢ Unlimited repos ‚Ä¢ FREE forever</p>
                                    </div>
                                </div>
                                <span id="githubStatus" class="text-xs px-2 py-1 rounded-full bg-gray-500/20 text-gray-400">Not connected</span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="text-sm text-gray-400 block mb-1">Personal Access Token</label>
                                    <input type="password" id="githubToken" placeholder="ghp_xxxx..." class="w-full px-4 py-2 glass rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 block mb-1">Repository</label>
                                    <input type="text" id="githubRepo" placeholder="username/repo" class="w-full px-4 py-2 glass rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-400 block mb-1">Branch</label>
                                    <input type="text" id="githubBranch" placeholder="main" value="main" class="w-full px-4 py-2 glass rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                                </div>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button onclick="connectGitHub()" class="px-4 py-2 btn-primary rounded-lg text-sm">
                                    <i class="fas fa-plug mr-2"></i>Connect
                                </button>
                                <a href="https://github.com/settings/tokens/new" target="_blank" class="px-4 py-2 glass rounded-lg text-sm hover:bg-white/10">
                                    <i class="fas fa-key mr-2"></i>Generate Token
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- General Settings -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4"><i class="fas fa-sliders-h mr-2"></i>General Settings</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 glass rounded-xl">
                            <div>
                                <p class="font-medium">Auto-sync</p>
                                <p class="text-sm text-gray-400">Automatically sync files when online</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoSync" checked class="sr-only peer" onchange="saveSetting('autoSync', this.checked)">
                                <div class="w-14 h-7 bg-gray-700 rounded-full peer peer-checked:bg-gradient-to-r peer-checked:from-indigo-500 peer-checked:to-purple-500 after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:after:translate-x-7"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between p-4 glass rounded-xl">
                            <div>
                                <p class="font-medium">Offline Mode</p>
                                <p class="text-sm text-gray-400">Work without internet connection</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="offlineMode" checked class="sr-only peer" onchange="saveSetting('offlineMode', this.checked)">
                                <div class="w-14 h-7 bg-gray-700 rounded-full peer peer-checked:bg-gradient-to-r peer-checked:from-indigo-500 peer-checked:to-purple-500 after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:after:translate-x-7"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between p-4 glass rounded-xl">
                            <div>
                                <p class="font-medium">Dark Mode</p>
                                <p class="text-sm text-gray-400">Use dark theme (always on)</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked disabled class="sr-only peer">
                                <div class="w-14 h-7 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full peer after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:translate-x-7"></div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Data Management -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4"><i class="fas fa-database mr-2"></i>Data Management</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="exportAllData()" class="p-4 glass rounded-xl hover:bg-indigo-500/20 transition-all text-left group">
                            <i class="fas fa-download text-2xl text-indigo-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium">Export All Data</p>
                            <p class="text-sm text-gray-400">Download complete backup (JSON)</p>
                        </button>
                        <button onclick="importData()" class="p-4 glass rounded-xl hover:bg-green-500/20 transition-all text-left group">
                            <i class="fas fa-upload text-2xl text-green-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium">Import Data</p>
                            <p class="text-sm text-gray-400">Restore from backup file</p>
                        </button>
                        <button onclick="clearAllData()" class="p-4 glass rounded-xl hover:bg-red-500/20 transition-all text-left group">
                            <i class="fas fa-trash text-2xl text-red-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium">Clear All Data</p>
                            <p class="text-sm text-gray-400">Delete everything permanently</p>
                        </button>
                        <button onclick="repairDatabase()" class="p-4 glass rounded-xl hover:bg-orange-500/20 transition-all text-left group">
                            <i class="fas fa-wrench text-2xl text-orange-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium">Repair Database</p>
                            <p class="text-sm text-gray-400">Fix corrupted data</p>
                        </button>
                    </div>
                </div>
                
                <!-- About -->
                <div class="glass rounded-2xl p-6 bg-gradient-to-br from-indigo-900/30 to-purple-900/30">
                    <h3 class="text-xl font-bold mb-2">About NexusCloud Pro</h3>
                    <p class="text-gray-400 mb-4">Version 2026.2.0 | BS Information Technology Project</p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="px-3 py-1 bg-indigo-500/20 rounded-full text-sm text-indigo-300">IndexedDB</span>
                        <span class="px-3 py-1 bg-purple-500/20 rounded-full text-sm text-purple-300">Supabase</span>
                        <span class="px-3 py-1 bg-green-500/20 rounded-full text-sm text-green-300">GitHub API</span>
                        <span class="px-3 py-1 bg-orange-500/20 rounded-full text-sm text-orange-300">PWA</span>
                        <span class="px-3 py-1 bg-pink-500/20 rounded-full text-sm text-pink-300">Tailwind CSS</span>
                    </div>
                    <p class="text-xs text-gray-500">Made with ‚ù§Ô∏è for BSIT 2026</p>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 glass rounded-xl p-4 transform translate-y-20 opacity-0 transition-all duration-300 z-[70] max-w-sm">
        <div class="flex items-center gap-3">
            <i id="toastIcon" class="fas fa-check-circle text-green-400 text-xl"></i>
            <div>
                <p id="toastTitle" class="font-medium text-sm">Success</p>
                <p id="toastMessage" class="text-gray-400 text-xs">Operation completed</p>
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-[60] flex items-center justify-center p-4">
        <div class="glass rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-auto slide-in">
            <div class="flex items-center justify-between mb-4 sticky top-0 bg-transparent">
                <h3 id="modalTitle" class="text-xl font-bold">Modal Title</h3>
                <button onclick="closeModal()" class="p-2 hover:bg-white/10 rounded-lg transition-all">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu glass rounded-xl p-2 hidden">
        <button onclick="contextAction('open')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 flex items-center gap-3">
            <i class="fas fa-eye w-4"></i> Open
        </button>
        <button onclick="contextAction('download')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 flex items-center gap-3">
            <i class="fas fa-download w-4"></i> Download
        </button>
        <button onclick="contextAction('share')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 flex items-center gap-3">
            <i class="fas fa-share w-4"></i> Share
        </button>
        <button onclick="contextAction('rename')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 flex items-center gap-3">
            <i class="fas fa-edit w-4"></i> Rename
        </button>
        <hr class="border-white/10 my-2">
        <button onclick="contextAction('delete')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-red-500/20 text-red-400 flex items-center gap-3">
            <i class="fas fa-trash w-4"></i> Delete
        </button>
    </div>
    
    <input type="file" id="importInput" class="hidden" accept=".json">

            <script>
        // ==================== IMMEDIATE FAILSAFE ====================
        window.addEventListener('load', function() {
            setTimeout(function() {
                var loader = document.getElementById('loadingScreen');
                if (loader) {
                    loader.style.opacity = '0';
                    loader.style.transition = 'opacity 0.3s';
                    setTimeout(function() { loader.style.display = 'none'; }, 300);
                }
            }, 3000);
        });

        // ==================== CONFIGURATION ====================
        const CONFIG = {
            DB_NAME: 'NexusCloudDB',
            DB_VERSION: 2,
            MAX_FILE_SIZE: 50 * 1024 * 1024,
            MAX_STORAGE: {
                local: 1024 * 1024 * 1024,
                supabase: 1024 * 1024 * 1024,
                github: 1024 * 1024 * 1024
            },
            SUPABASE_URL: 'https://kaysqlmdeuzmhxqbwnpk.supabase.co',
            SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtheXNxbG1kZXV6bWh4cWJ3bnBrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MjEwNDAsImV4cCI6MjA4NDM5NzA0MH0.Td3HkUynNWXFGy4XLekSdS3FK54786D9WE2TuhH9oQk'
        };

        // ==================== STATE ====================
        let db = null;
        let currentFolder = null;
        let sqlTables = {};
        let selectedFiles = new Set();
        let currentView = 'grid';
        let contextMenuTarget = null;

        let currentProvider = 'local';
        let isOnline = navigator.onLine;
        let sqlHistory = [];
        let notifications = [];

        // ==================== HIDE LOADER FUNCTION ====================
        function hideLoader() {
            const loader = document.getElementById('loadingScreen');
            if (loader) {
                loader.style.transition = 'opacity 0.3s ease';
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 300);
            }
        }

        // ==================== FAILSAFE: Hide loader after 5 seconds ====================
        // ==================== FAILSAFE & ERROR HANDLING ====================
        // Global error handler to force open app if script crashes
        window.onerror = function(msg, url, line) {
            console.error('Global Error:', msg);
            hideLoader();
            return false;
        };

        // Force hide loader after 3 seconds no matter what
        setTimeout(() => {
            const loader = document.getElementById('loadingScreen');
            if (loader && getComputedStyle(loader).opacity !== '0') {
                console.warn('‚ö†Ô∏è Failsafe: Force hiding loader');
                hideLoader();
            }
        }, 3000);

        // ==================== INITIALIZATION ====================
        // ==================== INITIALIZATION ====================
        async function init() {
            console.log('üöÄ Starting NexusCloud Pro initialization...');
            
            // 1. Initialize UI immediately (don't wait for DB)
            try {
                initParticles();
                initEventListeners();
                updateOnlineStatus();
                window.addEventListener('online', updateOnlineStatus);
                window.addEventListener('offline', updateOnlineStatus);
            } catch (e) { console.error('UI Init Error', e); }

            // 2. Load Data Safely
            try {
                // Initialize IndexedDB
                await initDB().catch(e => {
                    console.error('DB Init Failed:', e);
                    showToast('Database Error', 'Using temporary session', 'warning');
                });
                
                await loadSettings();
                
                // Load all data parallel, ignoring failures
                await Promise.allSettled([
                    loadFiles(),
                    loadSQLTables(),
                    updateStats(),
                    loadActivityLog(),
                    tryAutoConnect()
                ]);
                
            } catch (error) {
                console.error('‚ùå Core Init Error:', error);
            } finally {
                // 3. Reveal App
                hideLoader();
            }
        }
        // ==================== DATABASE ====================
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(CONFIG.DB_NAME, CONFIG.DB_VERSION);
                
                request.onerror = () => {
                    console.error('IndexedDB error:', request.error);
                    reject(request.error);
                };
                
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    
                    if (!database.objectStoreNames.contains('files')) {
                        const filesStore = database.createObjectStore('files', { keyPath: 'id', autoIncrement: true });
                        filesStore.createIndex('name', 'name', { unique: false });
                        filesStore.createIndex('type', 'type', { unique: false });
                        filesStore.createIndex('folder', 'folder', { unique: false });
                        filesStore.createIndex('created', 'created', { unique: false });
                        filesStore.createIndex('synced', 'synced', { unique: false });
                    }
                    
                    if (!database.objectStoreNames.contains('sqlTables')) {
                        database.createObjectStore('sqlTables', { keyPath: 'name' });
                    }
                    
                    if (!database.objectStoreNames.contains('activity')) {
                        const activityStore = database.createObjectStore('activity', { keyPath: 'id', autoIncrement: true });
                        activityStore.createIndex('timestamp', 'timestamp', { unique: false });
                    }
                    
                    if (!database.objectStoreNames.contains('settings')) {
                        database.createObjectStore('settings', { keyPath: 'key' });
                    }
                    
                    if (!database.objectStoreNames.contains('shared')) {
                        database.createObjectStore('shared', { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        // Generic DB operations with error handling
        async function dbAdd(storeName, data) {
            return new Promise((resolve, reject) => {
                if (!db) { reject(new Error('Database not initialized')); return; }
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.add(data);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        
        async function dbPut(storeName, data) {
            return new Promise((resolve, reject) => {
                if (!db) { reject(new Error('Database not initialized')); return; }
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        
        async function dbGet(storeName, key) {
            return new Promise((resolve, reject) => {
                if (!db) { resolve(null); return; }
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(key);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        
        async function dbGetAll(storeName) {
            return new Promise((resolve, reject) => {
                if (!db) { resolve([]); return; }
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => reject(request.error);
            });
        }
        
        async function dbDelete(storeName, key) {
            return new Promise((resolve, reject) => {
                if (!db) { reject(new Error('Database not initialized')); return; }
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(key);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }
        
        async function dbClear(storeName) {
            return new Promise((resolve, reject) => {
                if (!db) { reject(new Error('Database not initialized')); return; }
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.clear();
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // ==================== SETTINGS (FIXED) ====================
        async function loadSettings() {
            try {
                const settings = await loadAllSettings();
                
                // Load cloud credentials
                const supabaseUrl = document.getElementById('supabaseUrl');
                const supabaseKey = document.getElementById('supabaseKey');
                const githubToken = document.getElementById('githubToken');
                const githubRepo = document.getElementById('githubRepo');
                
                if (settings.supabaseUrl && supabaseUrl) supabaseUrl.value = settings.supabaseUrl;
                if (settings.supabaseKey && supabaseKey) supabaseKey.value = settings.supabaseKey;
                if (settings.githubToken && githubToken) githubToken.value = settings.githubToken;
                if (settings.githubRepo && githubRepo) githubRepo.value = settings.githubRepo;
                
                // Load toggle states
                const autoSync = document.getElementById('autoSync');
                const offlineMode = document.getElementById('offlineMode');
                
                if (settings.autoSync !== undefined && autoSync) {
                    autoSync.checked = settings.autoSync;
                }
                if (settings.offlineMode !== undefined && offlineMode) {
                    offlineMode.checked = settings.offlineMode;
                }
                
                // Check if setup guide was hidden
                if (settings.hideSetupGuide) {
                    const setupGuide = document.getElementById('setupGuide');
                    if (setupGuide) setupGuide.classList.add('hidden');
                }
            } catch (e) {
                console.warn('Settings load error:', e);
            }
        }

        async function loadAllSettings() {
            const settings = {};
            try {
                const all = await dbGetAll('settings');
                all.forEach(s => settings[s.key] = s.value);
            } catch (e) {
                console.warn('Error loading all settings:', e);
            }
            return settings;
        }

        async function saveSetting(key, value) {
            await dbPut('settings', { key, value });
        }

        function hideSetupGuide() {
            const el = document.getElementById('setupGuide');
            if (el) el.classList.add('hidden');
            saveSetting('hideSetupGuide', true);
        }

        // ==================== CLOUD PROVIDERS ====================
               async function tryAutoConnect() {
            if (CONFIG.SUPABASE_URL && CONFIG.SUPABASE_KEY) {
                try {
                    if (typeof window.supabase === 'undefined' || !window.supabase.createClient) {
                        console.warn('Supabase not available');
                        return;
                    }
                                        supabaseClient = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
                    currentProvider = 'supabase';
                    var statusEl = document.getElementById('supabaseStatus');
                    var syncEl = document.getElementById('syncStatus');
                    if (statusEl) {
                        statusEl.textContent = 'Connected';
                        statusEl.className = 'text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-400';
                    }
                    if (syncEl) syncEl.textContent = 'Cloud';
                    console.log('Supabase connected');
                } catch (e) {
                    console.warn('Supabase error:', e);
                }
            }
        }

        async function connectSupabase(silent = false) {
            const urlInput = document.getElementById('supabaseUrl');
            const keyInput = document.getElementById('supabaseKey');
            
            const url = urlInput?.value || (await dbGet('settings', 'supabaseUrl'))?.value;
            const key = keyInput?.value || (await dbGet('settings', 'supabaseKey'))?.value;
            
            if (!url || !key) {
                if (!silent) showToast('Error', 'Please enter Supabase URL and Key', 'error');
                return false;
            }
            
            try {
                                supabaseClient = window.supabase.createClient(url, key);
                
                await dbPut('settings', { key: 'supabaseUrl', value: url });
                await dbPut('settings', { key: 'supabaseKey', value: key });
                
                currentProvider = 'supabase';
                
                const statusEl = document.getElementById('supabaseStatus');
                const syncStatusEl = document.getElementById('syncStatus');
                
                if (statusEl) {
                    statusEl.textContent = 'Connected';
                    statusEl.className = 'text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-400';
                }
                if (syncStatusEl) syncStatusEl.textContent = 'Cloud';
                
                if (!silent) showToast('Connected', 'Supabase connected successfully!', 'success');
                return true;
            } catch (error) {
                console.error('Supabase connection error:', error);
                if (!silent) showToast('Error', 'Failed to connect to Supabase', 'error');
                return false;
            }
        }

        async function testSupabase() {
            const connected = await connectSupabase();
            if (connected) {
                showToast('Success', 'Connection test passed!', 'success');
            }
        }

        async function connectGitHub() {
            const token = document.getElementById('githubToken')?.value;
            const repo = document.getElementById('githubRepo')?.value;
            
            if (!token || !repo) {
                showToast('Error', 'Please enter GitHub token and repository', 'error');
                return;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}`, {
                    headers: { 'Authorization': `token ${token}` }
                });
                
                if (!response.ok) throw new Error('Invalid credentials');
                
                await dbPut('settings', { key: 'githubToken', value: token });
                await dbPut('settings', { key: 'githubRepo', value: repo });
                await dbPut('settings', { key: 'githubBranch', value: document.getElementById('githubBranch')?.value || 'main' });
                
                const statusEl = document.getElementById('githubStatus');
                if (statusEl) {
                    statusEl.textContent = 'Connected';
                    statusEl.className = 'text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-400';
                }
                
                showToast('Connected', 'GitHub connected successfully!', 'success');
            } catch (error) {
                showToast('Error', 'Failed to connect to GitHub', 'error');
            }
        }

        function switchProvider(provider) {
            currentProvider = provider;
            const providerNames = { local: 'Local Storage', supabase: 'Supabase Cloud', github: 'GitHub' };
            const syncStatusEl = document.getElementById('syncStatus');
            if (syncStatusEl) syncStatusEl.textContent = providerNames[provider] || 'Local';
            showToast('Provider Changed', `Now using ${providerNames[provider]}`, 'success');
        }

        async function syncData() {
            const syncIcon = document.getElementById('syncIcon');
            if (syncIcon) syncIcon.classList.add('fa-spin');
            
            showToast('Syncing', 'Syncing your data...', 'info');
            
            // Simulate sync delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (syncIcon) syncIcon.classList.remove('fa-spin');
            showToast('Synced', 'Data synchronized successfully!', 'success');
        }

        // ==================== FILE MANAGEMENT ====================
        async function loadFiles() {
            try {
                const files = await dbGetAll('files');
                const filter = document.getElementById('fileFilter')?.value || 'all';
                const sort = document.getElementById('sortOrder')?.value || 'newest';
                
                let filtered = files.filter(f => f.folder === currentFolder);
                
                if (filter !== 'all') {
                    filtered = filtered.filter(f => {
                        if (filter === 'folder') return f.type === 'folder';
                        if (filter === 'image') return f.type?.startsWith('image/');
                        if (filter === 'video') return f.type?.startsWith('video/');
                        if (filter === 'audio') return f.type?.startsWith('audio/');
                        if (filter === 'document') return !f.type?.startsWith('image/') && !f.type?.startsWith('video/') && !f.type?.startsWith('audio/') && f.type !== 'folder';
                        return true;
                    });
                }
                
                filtered.sort((a, b) => {
                    switch (sort) {
                        case 'oldest': return new Date(a.created) - new Date(b.created);
                        case 'name': return a.name.localeCompare(b.name);
                        case 'size': return (b.size || 0) - (a.size || 0);
                        default: return new Date(b.created) - new Date(a.created);
                    }
                });
                
                renderFiles(filtered);
                renderRecentFiles(files.slice().sort((a, b) => new Date(b.created) - new Date(a.created)).slice(0, 6));
                updateBreadcrumb();
                
                const badge = document.getElementById('filesBadge');
                if (badge) {
                    if (files.length > 0) {
                        badge.textContent = files.length;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            } catch (e) {
                console.warn('Error loading files:', e);
            }
        }

        function renderFiles(files) {
            const grid = document.getElementById('filesGrid');
            if (!grid) return;
            
            if (files.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-folder-open text-6xl text-gray-600 mb-4"></i>
                        <p class="text-gray-400 mb-2">No files found</p>
                        <button onclick="showSection('upload')" class="text-indigo-400 hover:text-indigo-300">
                            <i class="fas fa-upload mr-2"></i>Upload your first file
                        </button>
                    </div>
                `;
                return;
            }
            
            if (currentView === 'grid') {
                grid.className = 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 lg:gap-6';
                grid.innerHTML = files.map(file => `
                    <div class="file-card glass rounded-2xl p-4 lg:p-6 cursor-pointer relative group ${selectedFiles.has(file.id) ? 'ring-2 ring-indigo-500' : ''}" 
                         onclick="handleFileClick(event, ${file.id})" 
                         oncontextmenu="showContextMenu(event, ${file.id})">
                        <div class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <input type="checkbox" class="w-5 h-5 rounded" ${selectedFiles.has(file.id) ? 'checked' : ''} onclick="event.stopPropagation(); toggleSelect(${file.id})">
                        </div>
                        <div class="flex items-start justify-between mb-3">
                            <div class="w-12 h-12 lg:w-14 lg:h-14 rounded-xl ${getFileColor(file.type)} flex items-center justify-center">
                                <i class="fas ${getFileIcon(file.type)} text-xl lg:text-2xl"></i>
                            </div>
                            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="event.stopPropagation(); toggleStar(${file.id})" class="p-2 hover:bg-white/10 rounded-lg">
                                    <i class="fas fa-star ${file.starred ? 'text-yellow-400' : 'text-gray-500'}"></i>
                                </button>
                            </div>
                        </div>
                        <h4 class="font-semibold truncate text-sm mb-1">${escapeHtml(file.name)}</h4>
                        <p class="text-xs text-gray-400">${formatBytes(file.size || 0)}</p>
                        <div class="flex items-center justify-between mt-2">
                            <p class="text-xs text-gray-500">${formatDate(file.created)}</p>
                            ${file.synced ? '<i class="fas fa-cloud text-xs text-green-400" title="Synced"></i>' : '<i class="fas fa-hdd text-xs text-gray-500" title="Local only"></i>'}
                        </div>
                    </div>
                `).join('');
            } else {
                grid.className = 'space-y-2';
                grid.innerHTML = files.map(file => `
                    <div class="glass rounded-xl p-4 flex items-center gap-4 hover:bg-white/5 cursor-pointer ${selectedFiles.has(file.id) ? 'ring-2 ring-indigo-500' : ''}"
                         onclick="handleFileClick(event, ${file.id})"
                         oncontextmenu="showContextMenu(event, ${file.id})">
                        <input type="checkbox" class="w-5 h-5 rounded" ${selectedFiles.has(file.id) ? 'checked' : ''} onclick="event.stopPropagation(); toggleSelect(${file.id})">
                        <div class="w-10 h-10 rounded-lg ${getFileColor(file.type)} flex items-center justify-center flex-shrink-0">
                            <i class="fas ${getFileIcon(file.type)}"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium truncate">${escapeHtml(file.name)}</p>
                            <p class="text-xs text-gray-400">${formatBytes(file.size || 0)} ‚Ä¢ ${formatDate(file.created)}</p>
                        </div>
                        <button onclick="event.stopPropagation(); toggleStar(${file.id})" class="p-2 hover:bg-white/10 rounded-lg">
                            <i class="fas fa-star ${file.starred ? 'text-yellow-400' : 'text-gray-500'}"></i>
                        </button>
                        ${file.synced ? '<i class="fas fa-cloud text-green-400"></i>' : '<i class="fas fa-hdd text-gray-500"></i>'}
                    </div>
                `).join('');
            }
        }

        function renderRecentFiles(files) {
            const container = document.getElementById('recentFiles');
            if (!container) return;
            
            if (files.length === 0) {
                container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-8">No files uploaded yet. Start by uploading your first file!</p>';
                return;
            }
            
            container.innerHTML = files.map(file => `
                <div class="glass rounded-xl p-4 flex items-center gap-4 hover:bg-white/5 transition-all cursor-pointer" onclick="viewFile(${file.id})">
                    <div class="w-12 h-12 rounded-xl ${getFileColor(file.type)} flex items-center justify-center flex-shrink-0">
                        <i class="fas ${getFileIcon(file.type)} text-xl"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium truncate">${escapeHtml(file.name)}</p>
                        <p class="text-sm text-gray-400">${formatBytes(file.size || 0)}</p>
                    </div>
                </div>
            `).join('');
        }

        function handleFileClick(event, id) {
            if (event.ctrlKey || event.metaKey) {
                toggleSelect(id);
            } else if (event.shiftKey) {
                toggleSelect(id);
            } else {
                viewFile(id);
            }
        }

        async function viewFile(id) {
            const file = await dbGet('files', id);
            if (!file) return;
            
            if (file.type === 'folder') {
                navigateToFolder(id);
                return;
            }
            
            let preview = '';
            if (file.type?.startsWith('image/')) {
                preview = `<img src="${file.data}" class="max-w-full max-h-64 rounded-xl mx-auto" alt="${escapeHtml(file.name)}">`;
            } else if (file.type?.startsWith('video/')) {
                preview = `<video src="${file.data}" controls class="max-w-full rounded-xl mx-auto"></video>`;
            } else if (file.type?.startsWith('audio/')) {
                preview = `<audio src="${file.data}" controls class="w-full"></audio>`;
            } else if (file.type?.startsWith('text/') || file.type === 'application/json') {
                try {
                    const text = atob(file.data.split(',')[1]);
                    preview = `<pre class="bg-gray-900 p-4 rounded-xl overflow-auto max-h-64 text-sm text-green-400">${escapeHtml(text.substring(0, 5000))}${text.length > 5000 ? '\n...(truncated)' : ''}</pre>`;
                } catch (e) {
                    preview = '<p class="text-gray-400">Unable to preview this file</p>';
                }
            } else {
                preview = `
                    <div class="text-center py-8">
                        <i class="fas ${getFileIcon(file.type)} text-6xl text-indigo-400 mb-4"></i>
                        <p class="text-gray-400">Preview not available for this file type</p>
                    </div>
                `;
            }
            
            const content = `
                ${preview}
                <div class="grid grid-cols-2 gap-4 mt-6 text-sm">
                    <div class="glass rounded-xl p-3">
                        <p class="text-gray-400 text-xs">Size</p>
                        <p class="font-medium">${formatBytes(file.size || 0)}</p>
                    </div>
                    <div class="glass rounded-xl p-3">
                        <p class="text-gray-400 text-xs">Type</p>
                        <p class="font-medium truncate">${file.type || 'Unknown'}</p>
                    </div>
                    <div class="glass rounded-xl p-3">
                        <p class="text-gray-400 text-xs">Created</p>
                        <p class="font-medium">${new Date(file.created).toLocaleString()}</p>
                    </div>
                    <div class="glass rounded-xl p-3">
                        <p class="text-gray-400 text-xs">Status</p>
                        <p class="font-medium">${file.synced ? '‚òÅÔ∏è Synced' : 'üíæ Local only'}</p>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button onclick="downloadFile(${file.id}); closeModal();" class="flex-1 px-4 py-3 btn-primary rounded-xl font-semibold">
                        <i class="fas fa-download mr-2"></i>Download
                    </button>
                    <button onclick="shareFile(${file.id});" class="flex-1 px-4 py-3 glass rounded-xl font-semibold hover:bg-white/10">
                        <i class="fas fa-share mr-2"></i>Share
                    </button>
                    <button onclick="deleteFile(${file.id}); closeModal();" class="px-4 py-3 glass rounded-xl text-red-400 hover:bg-red-500/20">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            showModal(file.name, content);
        }

        async function uploadFiles(files) {
            const uploadQueue = document.getElementById('uploadQueue');
            const uploadList = document.getElementById('uploadList');
            if (uploadQueue) uploadQueue.classList.remove('hidden');
            if (uploadList) uploadList.innerHTML = '';
            
            let successCount = 0;
            
            for (const file of files) {
                if (file.size > CONFIG.MAX_FILE_SIZE) {
                    showToast('Error', `${file.name} exceeds 50MB limit`, 'error');
                    continue;
                }
                
                const fileId = Date.now() + Math.random().toString(36).substr(2, 9);
                
                if (uploadList) {
                    const uploadItem = document.createElement('div');
                    uploadItem.id = `upload-${fileId}`;
                    uploadItem.className = 'glass rounded-xl p-4';
                    uploadItem.innerHTML = `
                        <div class="flex items-center gap-4">
                            <i class="fas ${getFileIcon(file.type)} text-2xl text-indigo-400"></i>
                            <div class="flex-1 min-w-0">
                                <p class="font-medium truncate text-sm">${escapeHtml(file.name)}</p>
                                <p class="text-xs text-gray-400">${formatBytes(file.size)}</p>
                                <div class="w-full h-2 bg-gray-700 rounded-full mt-2 overflow-hidden">
                                    <div class="upload-progress h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="upload-percent text-sm text-gray-400">0%</span>
                        </div>
                    `;
                    uploadList.appendChild(uploadItem);
                }
                
                try {
                    const fileData = await readFileAsDataURL(file, document.getElementById(`upload-${fileId}`));
                    
                    const fileRecord = {
                        name: file.name,
                        type: file.type || 'application/octet-stream',
                        size: file.size,
                        data: fileData,
                        folder: currentFolder,
                        created: new Date().toISOString(),
                        modified: new Date().toISOString(),
                        starred: false,
                        synced: false
                    };
                    
                    await dbAdd('files', fileRecord);
                    await logActivity('upload', `Uploaded ${file.name}`);
                    successCount++;
                } catch (error) {
                    console.error('Upload error:', error);
                }
            }
            
            if (successCount > 0) {
                showToast('Upload Complete', `${successCount} file(s) uploaded`, 'success');
                await updateStats();
                await loadFiles();
            }
            
            setTimeout(() => {
                if (uploadQueue) uploadQueue.classList.add('hidden');
            }, 2000);
        }

        function readFileAsDataURL(file, uploadItem) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onprogress = (e) => {
                    if (e.lengthComputable && uploadItem) {
                        const percent = Math.round((e.loaded / e.total) * 100);
                        const progress = uploadItem.querySelector('.upload-progress');
                        const percentEl = uploadItem.querySelector('.upload-percent');
                        if (progress) progress.style.width = `${percent}%`;
                        if (percentEl) percentEl.textContent = `${percent}%`;
                    }
                };
                
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => reject(reader.error);
                reader.readAsDataURL(file);
            });
        }

        async function downloadFile(id) {
            const file = await dbGet('files', id);
            if (!file) return;
            
            const a = document.createElement('a');
            a.href = file.data;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            await logActivity('download', `Downloaded ${file.name}`);
            showToast('Download', 'Download started', 'success');
        }

        async function deleteFile(id) {
            const file = await dbGet('files', id);
            if (!file) return;
            
            if (confirm(`Delete "${file.name}"?`)) {
                await dbDelete('files', id);
                await logActivity('delete', `Deleted ${file.name}`);
                showToast('Deleted', `${file.name} deleted`, 'success');
                await updateStats();
                await loadFiles();
            }
        }

        async function toggleStar(id) {
            const file = await dbGet('files', id);
            if (!file) return;
            
            file.starred = !file.starred;
            await dbPut('files', file);
            loadFiles();
        }

        async function shareFile(id) {
            const file = await dbGet('files', id);
            if (!file) return;
            
            const shareId = btoa(`${file.id}-${Date.now()}`).substring(0, 16);
            const shareLink = `${window.location.origin}${window.location.pathname}?share=${shareId}`;
            
            await dbAdd('shared', {
                fileId: id,
                shareId,
                fileName: file.name,
                created: new Date().toISOString()
            });
            
            try {
                await navigator.clipboard.writeText(shareLink);
                showToast('Link Copied', 'Share link copied to clipboard!', 'success');
            } catch (e) {
                showModal('Share Link', `<input type="text" value="${shareLink}" class="w-full p-3 glass rounded-lg" readonly onclick="this.select()">`);
            }
            
            await logActivity('share', `Shared ${file.name}`);
        }

        function createFolder() {
            const name = prompt('Enter folder name:');
            if (!name?.trim()) return;
            
            const folderData = {
                name: name.trim(),
                type: 'folder',
                size: 0,
                folder: currentFolder,
                created: new Date().toISOString(),
                modified: new Date().toISOString(),
                starred: false,
                synced: false
            };
            
            dbAdd('files', folderData).then(() => {
                showToast('Created', `Folder "${name}" created`, 'success');
                logActivity('create', `Created folder ${name}`);
                loadFiles();
            });
        }

        function navigateToFolder(folderId) {
            currentFolder = folderId;
            loadFiles();
        }

        function updateBreadcrumb() {
            const el = document.getElementById('currentPath');
            if (el) el.textContent = currentFolder ? 'Subfolder' : 'Root';
        }

        function toggleSelect(id) {
            if (selectedFiles.has(id)) {
                selectedFiles.delete(id);
            } else {
                selectedFiles.add(id);
            }
            updateSelectionUI();
            loadFiles();
        }

        function clearSelection() {
            selectedFiles.clear();
            updateSelectionUI();
            loadFiles();
        }

        function updateSelectionUI() {
            const bar = document.getElementById('selectionBar');
            if (!bar) return;
            
            if (selectedFiles.size > 0) {
                bar.classList.remove('hidden');
                const countEl = document.getElementById('selectedCount');
                if (countEl) countEl.textContent = `${selectedFiles.size} item(s) selected`;
            } else {
                bar.classList.add('hidden');
            }
        }

        async function deleteSelected() {
            if (!confirm(`Delete ${selectedFiles.size} file(s)?`)) return;
            
            for (const id of selectedFiles) {
                await dbDelete('files', id);
            }
            
            showToast('Deleted', `${selectedFiles.size} file(s) deleted`, 'success');
            selectedFiles.clear();
            updateSelectionUI();
            await updateStats();
            await loadFiles();
        }

        async function downloadSelected() {
            for (const id of selectedFiles) {
                await downloadFile(id);
            }
            clearSelection();
        }

        function setView(view) {
            currentView = view;
            const gridBtn = document.getElementById('gridViewBtn');
            const listBtn = document.getElementById('listViewBtn');
            
            if (gridBtn) gridBtn.className = `p-3 glass rounded-xl ${view === 'grid' ? 'bg-white/10' : 'hover:bg-white/10'}`;
            if (listBtn) listBtn.className = `p-3 glass rounded-xl ${view === 'list' ? 'bg-white/10' : 'hover:bg-white/10'}`;
            
            loadFiles();
        }

        function filterFiles() { loadFiles(); }
        function sortFiles() { loadFiles(); }

        // Context Menu
        function showContextMenu(event, id) {
            event.preventDefault();
            contextMenuTarget = id;
            
            const menu = document.getElementById('contextMenu');
            if (menu) {
                menu.style.left = `${event.clientX}px`;
                menu.style.top = `${event.clientY}px`;
                menu.classList.remove('hidden');
            }
        }

        function hideContextMenu() {
            const menu = document.getElementById('contextMenu');
            if (menu) menu.classList.add('hidden');
        }

        async function contextAction(action) {
            hideContextMenu();
            if (!contextMenuTarget) return;
            
            switch (action) {
                case 'open':
                    viewFile(contextMenuTarget);
                    break;
                case 'download':
                    downloadFile(contextMenuTarget);
                    break;
                case 'share':
                    shareFile(contextMenuTarget);
                    break;
                case 'rename':
                    const file = await dbGet('files', contextMenuTarget);
                    if (file) {
                        const newName = prompt('Enter new name:', file.name);
                        if (newName?.trim()) {
                            file.name = newName.trim();
                            file.modified = new Date().toISOString();
                            await dbPut('files', file);
                            loadFiles();
                            showToast('Renamed', 'File renamed successfully', 'success');
                        }
                    }
                    break;
                case 'delete':
                    deleteFile(contextMenuTarget);
                    break;
            }
        }

        // ==================== SQL DATABASE ====================
        async function loadSQLTables() {
            try {
                const tables = await dbGetAll('sqlTables');
                sqlTables = {};
                tables.forEach(t => sqlTables[t.name] = t);
                renderTables();
            } catch (e) {
                console.warn('Error loading SQL tables:', e);
            }
        }

        function executeSQL() {
            const editor = document.getElementById('sqlEditor');
            const query = editor?.value?.trim();
            if (!query) return;
            
            const startTime = performance.now();
            
            try {
                const result = processSQL(query);
                const endTime = performance.now();
                
                displayResults(result);
                const timeEl = document.getElementById('queryTime');
                if (timeEl) timeEl.textContent = `${(endTime - startTime).toFixed(2)}ms`;
                
                sqlHistory.unshift({ query, timestamp: new Date().toISOString() });
                if (sqlHistory.length > 50) sqlHistory.pop();
                
                logActivity('sql', `Executed: ${query.substring(0, 40)}...`);
            } catch (error) {
                displayResults({ error: error.message });
            }
        }

        function processSQL(query) {
            const upperQuery = query.toUpperCase().trim();
            
            if (upperQuery.startsWith('CREATE TABLE')) return createTable(query);
            if (upperQuery.startsWith('INSERT INTO')) return insertInto(query);
            if (upperQuery.startsWith('SELECT')) return selectFrom(query);
            if (upperQuery.startsWith('UPDATE')) return updateTable(query);
            if (upperQuery.startsWith('DELETE FROM')) return deleteFrom(query);
            if (upperQuery.startsWith('DROP TABLE')) return dropTable(query);
            if (upperQuery.startsWith('TRUNCATE')) return truncateTable(query);
            if (upperQuery.startsWith('DESCRIBE') || upperQuery.startsWith('DESC')) return describeTable(query);
            if (upperQuery.startsWith('SHOW TABLES')) return showTables();
            
            throw new Error('Unsupported SQL command');
        }

        function createTable(query) {
            const match = query.match(/CREATE\s+TABLE\s+(?:IF\s+NOT\s+EXISTS\s+)?(\w+)\s*\((.+)\)/is);
            if (!match) throw new Error('Invalid CREATE TABLE syntax');
            
            const tableName = match[1].toLowerCase();
            
            if (sqlTables[tableName]) {
                if (query.toUpperCase().includes('IF NOT EXISTS')) {
                    return { message: `Table '${tableName}' already exists` };
                }
                throw new Error(`Table '${tableName}' already exists`);
            }
            
            const columns = match[2].split(',').map(col => {
                const parts = col.trim().split(/\s+/);
                return { name: parts[0], type: parts[1] || 'TEXT', constraints: parts.slice(2).join(' ').toUpperCase() };
            });
            
            sqlTables[tableName] = { name: tableName, columns, rows: [], created: new Date().toISOString() };
            dbPut('sqlTables', sqlTables[tableName]);
            renderTables();
            updateStats();
            
            return { message: `Table '${tableName}' created with ${columns.length} column(s)`, columns };
        }

        function insertInto(query) {
            const match = query.match(/INSERT\s+INTO\s+(\w+)\s*\(([^)]+)\)\s*VALUES\s*\((.+)\)/is);
            if (!match) throw new Error('Invalid INSERT syntax');
            
            const tableName = match[1].toLowerCase();
            const columns = match[2].split(',').map(c => c.trim());
            const values = match[3].match(/(?:[^,'"]+|'[^']*'|"[^"]*")+/g).map(v => v.trim().replace(/^['"]|['"]$/g, ''));
            
            if (!sqlTables[tableName]) throw new Error(`Table '${tableName}' does not exist`);
            if (columns.length !== values.length) throw new Error('Column count mismatch');
            
            const row = { _id: Date.now() };
            columns.forEach((col, i) => row[col] = values[i]);
            
            sqlTables[tableName].rows.push(row);
            dbPut('sqlTables', sqlTables[tableName]);
            updateStats();
            
            return { message: `1 row inserted into '${tableName}'` };
        }

        function selectFrom(query) {
            const match = query.match(/SELECT\s+(.+?)\s+FROM\s+(\w+)(?:\s+WHERE\s+(.+?))?(?:\s+ORDER\s+BY\s+(\w+)(?:\s+(ASC|DESC))?)?(?:\s+LIMIT\s+(\d+))?$/is);
            if (!match) throw new Error('Invalid SELECT syntax');
            
            const columns = match[1].trim();
            const tableName = match[2].toLowerCase();
            const whereClause = match[3];
            const orderBy = match[4];
            const orderDir = match[5]?.toUpperCase() || 'ASC';
            const limit = match[6] ? parseInt(match[6]) : null;
            
            if (!sqlTables[tableName]) throw new Error(`Table '${tableName}' does not exist`);
            
            let rows = [...sqlTables[tableName].rows];
            
            if (whereClause) {
                const conditions = parseWhereClause(whereClause);
                rows = rows.filter(row => evaluateConditions(row, conditions));
            }
            
            if (orderBy) {
                rows.sort((a, b) => {
                    const aVal = a[orderBy], bVal = b[orderBy];
                    const cmp = typeof aVal === 'number' ? aVal - bVal : String(aVal).localeCompare(String(bVal));
                    return orderDir === 'DESC' ? -cmp : cmp;
                });
            }
            
            if (limit) rows = rows.slice(0, limit);
            
            let resultColumns;
            if (columns === '*') {
                resultColumns = sqlTables[tableName].columns.map(c => c.name);
            } else {
                resultColumns = columns.split(',').map(c => c.trim());
                rows = rows.map(row => {
                    const newRow = {};
                    resultColumns.forEach(col => newRow[col] = row[col]);
                    return newRow;
                });
            }
            
            return { rows, columns: resultColumns };
        }

        function updateTable(query) {
            const match = query.match(/UPDATE\s+(\w+)\s+SET\s+(.+?)(?:\s+WHERE\s+(.+))?$/is);
            if (!match) throw new Error('Invalid UPDATE syntax');
            
            const tableName = match[1].toLowerCase();
            const setClause = match[2];
            const whereClause = match[3];
            
            if (!sqlTables[tableName]) throw new Error(`Table '${tableName}' does not exist`);
            
            const updates = {};
            setClause.split(',').forEach(s => {
                const [col, val] = s.split('=').map(x => x.trim());
                updates[col] = val.replace(/^['"]|['"]$/g, '');
            });
            
            let count = 0;
            sqlTables[tableName].rows.forEach(row => {
                if (!whereClause || evaluateConditions(row, parseWhereClause(whereClause))) {
                    Object.assign(row, updates);
                    count++;
                }
            });
            
            dbPut('sqlTables', sqlTables[tableName]);
            return { message: `${count} row(s) updated` };
        }

        function deleteFrom(query) {
            const match = query.match(/DELETE\s+FROM\s+(\w+)(?:\s+WHERE\s+(.+))?$/is);
            if (!match) throw new Error('Invalid DELETE syntax');
            
            const tableName = match[1].toLowerCase();
            const whereClause = match[2];
            
            if (!sqlTables[tableName]) throw new Error(`Table '${tableName}' does not exist`);
            
            const before = sqlTables[tableName].rows.length;
            if (whereClause) {
                const conditions = parseWhereClause(whereClause);
                sqlTables[tableName].rows = sqlTables[tableName].rows.filter(row => !evaluateConditions(row, conditions));
            } else {
                sqlTables[tableName].rows = [];
            }
            
            dbPut('sqlTables', sqlTables[tableName]);
            updateStats();
            return { message: `${before - sqlTables[tableName].rows.length} row(s) deleted` };
        }

        function dropTable(query) {
            const match = query.match(/DROP\s+TABLE\s+(?:IF\s+EXISTS\s+)?(\w+)/i);
            if (!match) throw new Error('Invalid DROP TABLE syntax');
            
            const tableName = match[1].toLowerCase();
            
            if (!sqlTables[tableName]) {
                if (query.toUpperCase().includes('IF EXISTS')) {
                    return { message: `Table '${tableName}' does not exist` };
                }
                throw new Error(`Table '${tableName}' does not exist`);
            }
            
            delete sqlTables[tableName];
            dbDelete('sqlTables', tableName);
            renderTables();
            updateStats();
            
            return { message: `Table '${tableName}' dropped` };
        }

        function truncateTable(query) {
            const match = query.match(/TRUNCATE\s+(?:TABLE\s+)?(\w+)/i);
            if (!match) throw new Error('Invalid TRUNCATE syntax');
            
            const tableName = match[1].toLowerCase();
            if (!sqlTables[tableName]) throw new Error(`Table '${tableName}' does not exist`);
            
            const count = sqlTables[tableName].rows.length;
            sqlTables[tableName].rows = [];
            dbPut('sqlTables', sqlTables[tableName]);
            
            return { message: `Table '${tableName}' truncated. ${count} row(s) removed.` };
        }

        function describeTable(query) {
            const match = query.match(/(?:DESCRIBE|DESC)\s+(\w+)/i);
            if (!match) throw new Error('Invalid DESCRIBE syntax');
            
            const tableName = match[1].toLowerCase();
            if (!sqlTables[tableName]) throw new Error(`Table '${tableName}' does not exist`);
            
            return { 
                rows: sqlTables[tableName].columns.map(c => ({
                    column: c.name, type: c.type, constraints: c.constraints || ''
                })),
                columns: ['column', 'type', 'constraints']
            };
        }

        function showTables() {
            const tables = Object.keys(sqlTables).map(name => ({
                table_name: name,
                rows: sqlTables[name].rows.length,
                columns: sqlTables[name].columns.length
            }));
            return { rows: tables, columns: ['table_name', 'rows', 'columns'] };
        }

        function parseWhereClause(clause) {
            const conditions = [];
            const parts = clause.split(/\s+(AND|OR)\s+/i);
            
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i].trim();
                if (part.toUpperCase() === 'AND' || part.toUpperCase() === 'OR') {
                    conditions.push({ type: part.toUpperCase() });
                } else {
                    const match = part.match(/(\w+)\s*(=|!=|<>|<|>|<=|>=|LIKE|IS)\s*(.+)/i);
                    if (match) {
                        conditions.push({
                            column: match[1],
                            operator: match[2].toUpperCase(),
                            value: match[3].replace(/^['"]|['"]$/g, '')
                        });
                    }
                }
            }
            return conditions;
        }

        function evaluateConditions(row, conditions) {
            let result = true;
            let nextOp = 'AND';
            
            for (const cond of conditions) {
                if (cond.type) {
                    nextOp = cond.type;
                } else {
                    const evalResult = evaluateCondition(row, cond);
                    result = nextOp === 'AND' ? result && evalResult : result || evalResult;
                }
            }
            return result;
        }

        function evaluateCondition(row, condition) {
            const { column, operator, value } = condition;
            const rowValue = row[column];
            
            switch (operator) {
                case '=': return rowValue == value;
                case '!=': case '<>': return rowValue != value;
                case '<': return parseFloat(rowValue) < parseFloat(value);
                case '>': return parseFloat(rowValue) > parseFloat(value);
                case '<=': return parseFloat(rowValue) <= parseFloat(value);
                case '>=': return parseFloat(rowValue) >= parseFloat(value);
                case 'LIKE': return new RegExp(value.replace(/%/g, '.*').replace(/_/g, '.'), 'i').test(rowValue);
                case 'IS': return value.toUpperCase() === 'NULL' ? rowValue == null : rowValue != null;
                default: return false;
            }
        }

        function displayResults(result) {
            const container = document.getElementById('queryResults');
            if (!container) return;
            
            if (result.error) {
                container.innerHTML = `<div class="text-red-400 p-4 bg-red-500/10 rounded-xl"><i class="fas fa-exclamation-circle mr-2"></i>${escapeHtml(result.error)}</div>`;
                return;
            }
            
            if (result.message) {
                container.innerHTML = `<div class="text-green-400 p-4 bg-green-500/10 rounded-xl"><i class="fas fa-check-circle mr-2"></i>${escapeHtml(result.message)}</div>`;
                return;
            }
            
            if (result.rows?.length > 0) {
                const headers = result.columns || Object.keys(result.rows[0]);
                container.innerHTML = `
                    <div class="overflow-auto">
                        <table class="w-full text-sm">
                            <thead><tr class="border-b border-white/10">${headers.map(h => `<th class="text-left p-3 text-indigo-400">${escapeHtml(h)}</th>`).join('')}</tr></thead>
                            <tbody>${result.rows.map((row, i) => `<tr class="table-row border-b border-white/5">${headers.map(h => `<td class="p-3">${row[h] ?? '<span class="text-gray-500">NULL</span>'}</td>`).join('')}</tr>`).join('')}</tbody>
                        </table>
                    </div>
                    <p class="text-gray-400 text-sm mt-4">${result.rows.length} row(s)</p>
                `;
            } else {
                container.innerHTML = '<p class="text-gray-400 text-center py-8">No results</p>';
            }
        }

        function renderTables() {
            const container = document.getElementById('tablesList');
            if (!container) return;
            
            const tables = Object.values(sqlTables);
            
            if (tables.length === 0) {
                container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-8">No tables yet</p>';
                return;
            }
            
            container.innerHTML = tables.map(table => `
                <div class="glass rounded-xl p-4 hover:bg-white/5 transition-all">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-semibold text-indigo-400">${escapeHtml(table.name)}</h4>
                        <span class="text-xs text-gray-400">${table.rows.length} rows</span>
                    </div>
                    <div class="text-xs text-gray-400 mb-3 truncate">${table.columns.map(c => c.name).join(', ')}</div>
                    <div class="flex gap-2">
                        <button onclick="quickQuery('SELECT * FROM ${table.name}')" class="px-3 py-1 text-xs glass rounded-lg hover:bg-white/10"><i class="fas fa-eye mr-1"></i>View</button>
                        <button onclick="quickQuery('DROP TABLE ${table.name}')" class="px-3 py-1 text-xs glass rounded-lg hover:bg-red-500/20 text-red-400"><i class="fas fa-trash mr-1"></i>Drop</button>
                    </div>
                </div>
            `).join('');
        }

        function quickQuery(query) {
            const editor = document.getElementById('sqlEditor');
            if (editor) editor.value = query;
            executeSQL();
        }

        function loadTemplate(type) {
            const templates = {
                users: `CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT, email TEXT, created_at TEXT);
INSERT INTO users (id, name, email, created_at) VALUES (1, 'John Doe', 'john@email.com', '2024-01-15');
SELECT * FROM users;`,
                products: `CREATE TABLE IF NOT EXISTS products (id INTEGER PRIMARY KEY, name TEXT, price REAL, stock INTEGER);
INSERT INTO products (id, name, price, stock) VALUES (1, 'Laptop', 999.99, 50);
SELECT * FROM products;`,
                orders: `CREATE TABLE IF NOT EXISTS orders (id INTEGER PRIMARY KEY, user_id INTEGER, total REAL, status TEXT);
SELECT * FROM orders;`,
                logs: `CREATE TABLE IF NOT EXISTS logs (id INTEGER PRIMARY KEY, action TEXT, timestamp TEXT);
SELECT * FROM logs;`
            };
            
            const editor = document.getElementById('sqlEditor');
            if (editor) editor.value = templates[type] || '';
        }

        function formatSQL() {
            const editor = document.getElementById('sqlEditor');
            if (!editor) return;
            let sql = editor.value.replace(/\s+/g, ' ').trim();
            sql = sql.replace(/(SELECT|FROM|WHERE|INSERT|INTO|VALUES|UPDATE|SET|DELETE|CREATE|TABLE|DROP|ORDER BY|LIMIT)/gi, '\n$1');
            editor.value = sql.trim();
            updateLineNumbers();
        }

        function clearSQL() {
            const editor = document.getElementById('sqlEditor');
            if (editor) editor.value = '';
            const results = document.getElementById('queryResults');
            if (results) results.innerHTML = '<p class="text-gray-400 text-center py-8"><i class="fas fa-database text-4xl mb-4 block opacity-50"></i>Execute a query</p>';
            updateLineNumbers();
        }

        function updateLineNumbers() {
            const editor = document.getElementById('sqlEditor');
            const lineNumbers = document.getElementById('lineNumbers');
            if (!editor || !lineNumbers) return;
            const lines = editor.value.split('\n').length;
            lineNumbers.innerHTML = Array.from({length: lines}, (_, i) => i + 1).join('<br>');
        }

        function refreshTables() {
            loadSQLTables();
            showToast('Refreshed', 'Tables updated', 'success');
        }

        function showSQLHistory() {
            if (sqlHistory.length === 0) {
                showToast('Empty', 'No history yet', 'info');
                return;
            }
            
            const content = sqlHistory.map((h, i) => `
                <div class="glass rounded-xl p-3 mb-2 cursor-pointer hover:bg-white/10" onclick="loadHistoryQuery(${i})">
                    <pre class="text-green-400 text-xs truncate">${escapeHtml(h.query)}</pre>
                    <p class="text-xs text-gray-400 mt-1">${formatRelativeTime(h.timestamp)}</p>
                </div>
            `).join('');
            
            showModal('Query History', content);
        }

        function loadHistoryQuery(index) {
            const editor = document.getElementById('sqlEditor');
            if (editor) editor.value = sqlHistory[index].query;
            closeModal();
            updateLineNumbers();
        }

        function exportResults() {
            const table = document.querySelector('#queryResults table');
            if (!table) {
                showToast('No Data', 'Execute a query first', 'warning');
                return;
            }
            
            let csv = '';
            table.querySelectorAll('tr').forEach(row => {
                const cells = row.querySelectorAll('th, td');
                csv += Array.from(cells).map(c => `"${c.textContent.replace(/"/g, '""')}"`).join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'results.csv';
            a.click();
            
            showToast('Exported', 'CSV downloaded', 'success');
        }

        function explainSQL() {
            showToast('SQL', 'This query retrieves or modifies data', 'info');
        }

        function cancelAllUploads() {
            const queue = document.getElementById('uploadQueue');
            const list = document.getElementById('uploadList');
            if (queue) queue.classList.add('hidden');
            if (list) list.innerHTML = '';
        }

        // ==================== ANALYTICS ====================
        async function updateStats() {
            try {
                const files = await dbGetAll('files');
                const tables = await dbGetAll('sqlTables');
                
                const totalSize = files.reduce((sum, f) => sum + (f.size || 0), 0);
                const totalRecords = tables.reduce((sum, t) => sum + (t.rows?.length || 0), 0);
                const maxStorage = CONFIG.MAX_STORAGE[currentProvider];
                const usedPercent = (totalSize / maxStorage) * 100;
                
                // Update elements safely
                const elements = {
                    'totalFiles': files.length,
                    'totalSize': formatBytes(totalSize),
                    'totalRecords': totalRecords,
                    'storagePercent': usedPercent.toFixed(1) + '%',
                    'storageText': `${formatBytes(totalSize)} of ${formatBytes(maxStorage)}`,
                    'maxStorageDisplay': formatBytes(maxStorage),
                    'ringPercent': usedPercent.toFixed(1) + '%'
                };
                
                Object.entries(elements).forEach(([id, value]) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = value;
                });
                
                const storageBar = document.getElementById('storageBar');
                if (storageBar) storageBar.style.width = Math.min(usedPercent, 100) + '%';
                
                const ring = document.getElementById('storageRing');
                if (ring) {
                    const offset = 251.2 - (251.2 * Math.min(usedPercent, 100) / 100);
                    ring.style.strokeDashoffset = offset;
                }
                
                updateFileTypesChart(files);
                updateStorageBreakdown(files);
            } catch (e) {
                console.warn('Stats update error:', e);
            }
        }

        function updateFileTypesChart(files) {
            const types = {};
            files.forEach(f => {
                const category = getFileCategory(f.type);
                types[category] = (types[category] || 0) + 1;
            });
            
            const container = document.getElementById('fileTypesChart');
            if (!container) return;
            
            const total = files.length || 1;
            
            if (Object.keys(types).length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center">No files</p>';
                return;
            }
            
            container.innerHTML = Object.entries(types).map(([type, count]) => `
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>${type}</span>
                        <span class="text-gray-400">${count} (${(count/total*100).toFixed(0)}%)</span>
                    </div>
                    <div class="w-full h-2 bg-gray-700 rounded-full overflow-hidden">
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-500 h-full rounded-full" style="width: ${(count/total*100)}%"></div>
                    </div>
                </div>
            `).join('');
        }

        function updateStorageBreakdown(files) {
            const breakdown = {};
            files.forEach(f => {
                const category = getFileCategory(f.type);
                breakdown[category] = (breakdown[category] || 0) + (f.size || 0);
            });
            
            const container = document.getElementById('storageBreakdown');
            if (!container) return;
            
            if (Object.keys(breakdown).length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center text-sm">No data</p>';
                return;
            }
            
            container.innerHTML = Object.entries(breakdown).sort((a, b) => b[1] - a[1]).map(([type, size]) => `
                <div class="flex items-center justify-between">
                    <span>${type}</span>
                    <span class="text-gray-400">${formatBytes(size)}</span>
                </div>
            `).join('');
        }

        // ==================== ACTIVITY ====================
        async function logActivity(action, message) {
            try {
                await dbAdd('activity', { action, message, timestamp: new Date().toISOString() });
                loadActivityLog();
                
                notifications.unshift({ action, message, id: Date.now(), timestamp: new Date().toISOString() });
                if (notifications.length > 20) notifications.pop();
                updateNotificationBadge();
            } catch (e) {
                console.warn('Activity log error:', e);
            }
        }

        async function loadActivityLog() {
            try {
                const activities = await dbGetAll('activity');
                const container = document.getElementById('activityLog');
                if (!container) return;
                
                const recent = activities.slice(-30).reverse();
                
                if (recent.length === 0) {
                    container.innerHTML = '<p class="text-gray-400 text-center py-8">No activity</p>';
                    return;
                }
                
                const icons = {
                    upload: 'fa-upload text-green-400',
                    download: 'fa-download text-blue-400',
                    delete: 'fa-trash text-red-400',
                    create: 'fa-plus text-purple-400',
                    sql: 'fa-database text-orange-400',
                    share: 'fa-share text-pink-400'
                };
                
                container.innerHTML = recent.map(a => `
                    <div class="flex items-center gap-4 p-3 glass rounded-xl">
                        <div class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                            <i class="fas ${icons[a.action] || 'fa-circle text-gray-400'}"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm truncate">${escapeHtml(a.message)}</p>
                            <p class="text-xs text-gray-400">${formatRelativeTime(a.timestamp)}</p>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.warn('Activity load error:', e);
            }
        }

        async function clearActivity() {
            if (!confirm('Clear all activity?')) return;
            await dbClear('activity');
            notifications = [];
            updateNotificationBadge();
            loadActivityLog();
            showToast('Cleared', 'Activity cleared', 'success');
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notifBadge');
            if (badge) {
                badge.textContent = notifications.length;
                badge.style.display = notifications.length > 0 ? 'flex' : 'none';
            }
        }

        function showNotifications() {
            const content = notifications.length === 0 
                ? '<p class="text-gray-400 text-center py-8">No notifications</p>'
                : notifications.map(n => `
                    <div class="glass rounded-xl p-3 mb-2">
                        <p class="text-sm">${escapeHtml(n.message)}</p>
                        <p class="text-xs text-gray-400">${formatRelativeTime(n.timestamp)}</p>
                    </div>
                `).join('');
            
            showModal('Notifications', content);
        }

        // ==================== DATA MANAGEMENT ====================
        async function exportAllData() {
            const data = {
                files: (await dbGetAll('files')).map(f => ({ ...f, data: '[EXCLUDED]' })),
                sqlTables: await dbGetAll('sqlTables'),
                activity: await dbGetAll('activity'),
                exportDate: new Date().toISOString(),
                version: '2026.2.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `nexuscloud-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showToast('Exported', 'Data exported!', 'success');
        }

        function exportData() { exportAllData(); }

        function importData() {
            const input = document.getElementById('importInput');
            if (input) input.click();
        }

        async function handleImport(event) {
            const file = event.target.files?.[0];
            if (!file) return;
            
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                
                if (data.sqlTables) {
                    for (const table of data.sqlTables) {
                        await dbPut('sqlTables', table);
                    }
                }
                
                await loadSQLTables();
                await updateStats();
                showToast('Imported', 'Data imported!', 'success');
            } catch (error) {
                showToast('Error', 'Import failed', 'error');
            }
            event.target.value = '';
        }

        async function clearAllData() {
            if (!confirm('Delete ALL data?')) return;
            if (!confirm('Are you sure?')) return;
            
            await dbClear('files');
            await dbClear('sqlTables');
            await dbClear('activity');
            await dbClear('shared');
            
            sqlTables = {};
            selectedFiles.clear();
            notifications = [];
            
            await loadFiles();
            await loadSQLTables();
            await updateStats();
            updateNotificationBadge();
            
            showToast('Cleared', 'All data deleted', 'success');
        }

        function repairDatabase() {
            showToast('Complete', 'Database verified', 'success');
        }

        // ==================== UI ====================
        function showSection(section) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            const sectionEl = document.getElementById(`${section}Section`);
            if (sectionEl) sectionEl.classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
            
            const titles = {
                dashboard: 'Dashboard', files: 'My Files', upload: 'Upload Files',
                database: 'SQL Database', analytics: 'Analytics', shared: 'Shared Files', settings: 'Settings'
            };
            
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) pageTitle.textContent = titles[section] || 'Dashboard';
            
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar) sidebar.classList.add('-translate-x-full');
            if (overlay) overlay.classList.add('hidden');
            
            if (section === 'analytics') {
                updateStats();
                loadActivityLog();
            }
            if (section === 'database') updateLineNumbers();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar) sidebar.classList.toggle('-translate-x-full');
            if (overlay) overlay.classList.toggle('hidden');
        }

        function showModal(title, content) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const modal = document.getElementById('modal');
            
            if (modalTitle) modalTitle.textContent = title;
            if (modalContent) modalContent.innerHTML = content;
            if (modal) modal.classList.remove('hidden');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            if (modal) modal.classList.add('hidden');
        }

        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const titleEl = document.getElementById('toastTitle');
            const messageEl = document.getElementById('toastMessage');
            
            if (!toast) return;
            
            const icons = {
                success: 'fa-check-circle text-green-400',
                error: 'fa-exclamation-circle text-red-400',
                warning: 'fa-exclamation-triangle text-yellow-400',
                info: 'fa-info-circle text-blue-400'
            };
            
            if (icon) icon.className = `fas ${icons[type]} text-xl`;
            if (titleEl) titleEl.textContent = title;
            if (messageEl) messageEl.textContent = message;
            
            toast.classList.remove('translate-y-20', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        function updateOnlineStatus() {
            isOnline = navigator.onLine;
            const status = document.getElementById('cloudStatus');
            const banner = document.getElementById('connectionBanner');
            
            if (status) {
                status.innerHTML = isOnline 
                    ? '<span class="connection-status online online-indicator"><i class="fas fa-circle text-xs"></i></span>'
                    : '<span class="connection-status offline"><i class="fas fa-circle text-xs"></i></span>';
            }
            
            if (banner) {
                banner.classList.toggle('hidden', isOnline);
            }
        }

        // ==================== UTILITIES ====================
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatRelativeTime(date) {
            const diff = Date.now() - new Date(date).getTime();
            const mins = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (mins < 1) return 'Just now';
            if (mins < 60) return `${mins}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        function getFileIcon(type) {
            if (!type) return 'fa-file';
            if (type === 'folder') return 'fa-folder';
            if (type.startsWith('image/')) return 'fa-file-image';
            if (type.startsWith('video/')) return 'fa-file-video';
            if (type.startsWith('audio/')) return 'fa-file-audio';
            if (type.includes('pdf')) return 'fa-file-pdf';
            return 'fa-file';
        }

        function getFileColor(type) {
            if (!type) return 'bg-gray-500/20';
            if (type === 'folder') return 'bg-yellow-500/20 text-yellow-400';
            if (type.startsWith('image/')) return 'bg-indigo-500/20 text-indigo-400';
            if (type.startsWith('video/')) return 'bg-green-500/20 text-green-400';
            if (type.startsWith('audio/')) return 'bg-orange-500/20 text-orange-400';
            return 'bg-purple-500/20 text-purple-400';
        }

        function getFileCategory(type) {
            if (!type) return 'Other';
            if (type === 'folder') return 'Folders';
            if (type.startsWith('image/')) return 'Images';
            if (type.startsWith('video/')) return 'Videos';
            if (type.startsWith('audio/')) return 'Audio';
            return 'Documents';
        }

        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function search(query) {
            if (!query.trim()) {
                loadFiles();
                return;
            }
            
            const q = query.toLowerCase();
            dbGetAll('files').then(files => {
                const filtered = files.filter(f => f.name.toLowerCase().includes(q));
                renderFiles(filtered);
            });
        }

        // ==================== EVENT LISTENERS ====================
        function initEventListeners() {
            // Drag & drop
            const dropZone = document.getElementById('dropZone');
            
            if (dropZone) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
                    dropZone.addEventListener(event, (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                    });
                });
                
                ['dragenter', 'dragover'].forEach(event => {
                    dropZone.addEventListener(event, () => dropZone.classList.add('drop-active'));
                });
                
                ['dragleave', 'drop'].forEach(event => {
                    dropZone.addEventListener(event, () => dropZone.classList.remove('drop-active'));
                });
                
                dropZone.addEventListener('drop', (e) => {
                    const files = e.dataTransfer.files;
                    if (files.length > 0) uploadFiles(files);
                });
                
                dropZone.addEventListener('click', () => {
                    document.getElementById('fileInput')?.click();
                });
            }
            
            // File input
            document.getElementById('fileInput')?.addEventListener('change', (e) => {
                if (e.target.files.length > 0) uploadFiles(e.target.files);
            });
            
            // Import input
            document.getElementById('importInput')?.addEventListener('change', handleImport);
            
            // SQL editor
            const sqlEditor = document.getElementById('sqlEditor');
            if (sqlEditor) {
                sqlEditor.addEventListener('input', updateLineNumbers);
                sqlEditor.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                        e.preventDefault();
                        executeSQL();
                    }
                });
            }
            
            // Close context menu on click
            document.addEventListener('click', hideContextMenu);
            
            // Close modal on backdrop click
            document.getElementById('modal')?.addEventListener('click', (e) => {
                if (e.target.id === 'modal') closeModal();
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    hideContextMenu();
                }
            });
            
            // Search
            let searchTimeout;
            const searchInput = document.getElementById('globalSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => search(e.target.value), 300);
                });
            }
        }

        // ==================== PARTICLES ====================
        function initParticles() {
            const container = document.getElementById('particles');
            if (!container) return;
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.cssText = `
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation-delay: ${Math.random() * 20}s;
                    animation-duration: ${15 + Math.random() * 10}s;
                `;
                container.appendChild(particle);
            }
        }

        // ==================== SERVICE WORKER ====================
                // ==================== INITIALIZATION ====================
        async function init() {
            try {
                console.log('NexusCloud Pro initializing...');
                
                // Initialize database
                await initDB();
                
                // Initialize particles
                initParticles();
                
                // Initialize event listeners
                initEventListeners();
                
                // Try auto-connect to Supabase
                await tryAutoConnect();
                
                // Load data
                await loadFiles();
                await loadSQLTables();
                await updateStats();
                await loadActivityLog();
                
                // Update online status
                updateOnlineStatus();
                window.addEventListener('online', updateOnlineStatus);
                window.addEventListener('offline', updateOnlineStatus);
                
                // Hide loader
                const loader = document.getElementById('loader');
                if (loader) {
                    loader.style.opacity = '0';
                    loader.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 500);
                }
                
                console.log('NexusCloud Pro initialized successfully');
            } catch (error) {
                console.error('Initialization error:', error);
                // Still hide loader on error to show UI
                const loader = document.getElementById('loader');
                if (loader) loader.style.display = 'none';
                showToast('Warning', 'Some features may be limited', 'warning');
            }
        }

        // ==================== SERVICE WORKER ====================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(() => {});
            });
        }

        // ==================== START ====================
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
